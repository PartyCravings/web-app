#!/usr/bin/env php
<?php

umask(0000);
set_time_limit(0);

require __DIR__.'/../vendor/autoload.php';

use React\EventLoop\Factory;
use React\Http\Server as HttpServer;
use React\Socket\Server as SocketServer;
use AppBundle\Utils\Server as ApplicationServer;

$server = new ApplicationServer();
$server->bootstrap($server->kernel);
$callback = $server->getCallBack($server->application);

$loop = Factory::create();
$http = new HttpServer($callback);
$socket = new SocketServer(getenv('SERVERPORT') ?: 1337, $loop);
$http->listen($socket);
$loop->run();
